apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "chronos.fullname" . }}
  labels:
    {{- include "chronos.labels" . | nindent 4 }}
data:
  chronos.yaml: |
    cluster:
      node_id: ${CHRONOS_NODE_ID}
      data_dir: ${CHRONOS_DATA_DIR}
      raft:
        address: ${CHRONOS_RAFT_ADDRESS}
        peers:
          {{- $fullname := include "chronos.fullname" . }}
          {{- $raftPort := .Values.service.raftPort }}
          {{- range $i := until (int .Values.replicaCount) }}
          - {{ $fullname }}-{{ $i }}.{{ $fullname }}-headless:{{ $raftPort }}
          {{- end }}
    
    server:
      http:
        address: ${CHRONOS_HTTP_ADDRESS}
        read_timeout: 30s
        write_timeout: 30s
    
    scheduler:
      tick_interval: {{ .Values.config.scheduler.tickInterval }}
      execution_timeout: {{ .Values.config.scheduler.executionTimeout }}
    
    dispatcher:
      http:
        timeout: {{ .Values.config.dispatcher.http.timeout }}
        max_idle_conns: {{ .Values.config.dispatcher.http.maxIdleConns }}
    
    metrics:
      prometheus:
        enabled: {{ .Values.config.metrics.prometheus.enabled }}
        path: {{ .Values.config.metrics.prometheus.path }}
    
    logging:
      level: {{ .Values.config.logging.level }}
      format: {{ .Values.config.logging.format }}
